name: tp-1
on:
 push:
  branches : dani
 workflow_dispatch:

jobs:
  train-and-evaluate:
   runs-on: ubuntu-latest
   steps:
    - name: checkout repo
      uses: actions/checkout@v3
    - name: set-up-python
      uses: actions/setup-python@v4
      with:
       python-version: "3.10"
    - name: install dependences
      run: |
       python -m pip install --upgrade pip
       python -m pip install -r  script/requirements.txt
    - name: generate doc
      run: |
        mkdir -p doc
        python -m pydoc -w script/training.py
        python -m pydoc -w script/evaluation.py
        mv training.html  evaluation.html doc/

    - name: python list
      run: pip list
    - name: Check sklearn installation
      run: python -c "import sklearn; print('âœ… sklearn version:', sklearn.__version__)"
    - name: train the model
      run:
       python script/training.py

    - name: evaluate the model
      run:
       python script/evaluation.py
    - name: create zip model + docs
      run: |
       zip -r bundle.zip model/ doc/
    - name: install email dependences
      run: |
       python -m pip install secure-smtplib
    - name: send mail
      env:
       SMTP_SERVER: ${{secrets.SMTP_SERVER}}
       SMTP_PORT : ${{secrets.SMTP_PORT}}
       EMAIL_SENDER: ${{secrets.EMAIL_SENDER}}
       EMAIL_RECEIVER: ${{secrets.EMAIL_RECEIVER}}
      run: python script/send_email.py

  


